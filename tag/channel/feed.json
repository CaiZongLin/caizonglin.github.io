{
    "version": "https://jsonfeed.org/version/1",
    "title": "Lex Blog • All posts by \"channel\" tag",
    "description": "",
    "home_page_url": "https://caizonglin.github.io",
    "items": [
        {
            "id": "https://caizonglin.github.io/2023/02/01/Golang%E7%9A%84Channel-1/",
            "url": "https://caizonglin.github.io/2023/02/01/Golang%E7%9A%84Channel-1/",
            "title": "Golang的Channel(1)",
            "date_published": "2023-02-01T07:43:01.000Z",
            "content_html": "<p><span id=\"0\"> <img data-src=\"https://i.imgur.com/IPZDBpj.png\" alt=\" \"> </span></p>\n<h2 id=\"Channel-是什麼？\"><a href=\"#Channel-是什麼？\" class=\"headerlink\" title=\"Channel 是什麼？\"></a>Channel 是什麼？</h2><p><img data-src=\"https://i.imgur.com/mdRUDti.png\" alt=\"Channel 示意圖\"></p>\n<p>channel能夠在多個goroutine之間作數據交換，像是在公共場所很多人的情況下, 大家在遵守著排隊的習慣, 目的是避免擁擠、插隊導致的低效資源使用與交換過程。</p>\n<ul>\n<li>chan的空值是nil</li>\n<li>聲明完通道後, 要透過make來產生實例</li>\n<li>發送資料 &lt;- , 通道變數 &lt;- 值</li>\n</ul>\n<h2 id=\"宣告一個Channel\"><a href=\"#宣告一個Channel\" class=\"headerlink\" title=\"宣告一個Channel\"></a>宣告一個Channel</h2><ol>\n<li>var 通道名稱 chan 通道類型</li>\n<li>chan的空值是nil</li>\n<li>聲明完通道後, 要透過<strong>make</strong>來產生實例</li>\n<li>通道實例 :&#x3D; make(chan 通類類型, [bufferSize int])</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> chanInt <span class=\"keyword\">chan</span> <span class=\"type\">int</span></span><br><span class=\"line\">    fmt.Println(chanInt) <span class=\"comment\">//nil</span></span><br><span class=\"line\">    chanInt = <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>宣告的時候需要加上 chan keyword 再加上 管道裡面要放怎樣型態的 element，所以上面的例子來看：var chanInt chan int 代表了宣告了一個叫做 chanInt 的變數，這個變數是 chan 型態，裡面可以放 int 型態的 element</li>\n<li>如果只有單純宣告就輸出的話，會輸出成 nil</li>\n</ul>\n<h2 id=\"向通道塞入元素\"><a href=\"#向通道塞入元素\" class=\"headerlink\" title=\"向通道塞入元素\"></a>向通道塞入元素</h2><h3 id=\"錯誤用法\"><a href=\"#錯誤用法\" class=\"headerlink\" title=\"錯誤用法\"></a>錯誤用法</h3><p>如果宣告完 channel 就直接往裡面放元素 <code>(沒有make)</code> 會導致以下錯誤：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> chanInt <span class=\"keyword\">chan</span> <span class=\"type\">int</span></span><br><span class=\"line\">    fmt.Println(chanInt)</span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">10</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight vb\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fetal <span class=\"keyword\">error</span>: all goroutines are asleep - deadlock!</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"正確用法\"><a href=\"#正確用法\" class=\"headerlink\" title=\"正確用法\"></a>正確用法</h3><p>應該是要宣告的時候同時也要進行初始化(make)的動作：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> chanInt <span class=\"keyword\">chan</span> <span class=\"type\">int</span></span><br><span class=\"line\">    chanInt = <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">10</span></span><br><span class=\"line\">    fmt.Println(&lt;- chanInt)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>透過 make 給予管道內的容量為 1，代表可以放一個元素</li>\n<li>透過 &lt;- 來放進元素，透過 &lt;- 放在 channel 變數就代表取出管道內的元素，因此這邊就會輸出為 10</li>\n</ul>\n<p>我們可以透過 *len()<em>、</em>cap()*來確認是否真的有從通道中取到元素。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> chanInt <span class=\"keyword\">chan</span> <span class=\"type\">int</span></span><br><span class=\"line\">    chanInt = <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">    fmt.Println(<span class=\"built_in\">len</span>(chanInt)) <span class=\"comment\">//0</span></span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">10</span></span><br><span class=\"line\">    fmt.Println(<span class=\"built_in\">len</span>(chanInt)) <span class=\"comment\">//1</span></span><br><span class=\"line\">    fmt.Println(&lt;- chanInt) <span class=\"comment\">//10 </span></span><br><span class=\"line\">    fmt.Println(<span class=\"built_in\">len</span>(chanInt)) <span class=\"comment\">//0</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>這邊用len()取得的是通道內<strong>元素的數量</strong>，所以第一個會是0。<br>當做了這個動作 <code>chanInt &lt;- 10</code>，意思是往這個通道塞入一個元素，所以數量會變成1，而在把它取出後，通道內元素就會變回0。</p>\n</blockquote>\n<h2 id=\"特別注意\"><a href=\"#特別注意\" class=\"headerlink\" title=\"特別注意\"></a>特別注意</h2><p>channel內的數量一旦滿了之後，再往裡面放元素會造成 block 的動作，除非有取出的動作不然就會被<em>block</em>住，如下:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> chanInt = <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">1</span></span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">2</span></span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">3</span></span><br><span class=\"line\">    &lt;- chanInt</span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">4</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>這樣就可以往裡面放 4，然後取出來的元素可以給一個變數或是也不給，不給的話就像上面那樣單純取出來就可以了。</p>\n</blockquote>\n<p>這邊可以注意的是，取出來的順序是先進先出，所以這邊取出來是取出 1。可以輸出來做驗證：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> chanInt = <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"type\">int</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">1</span></span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">2</span></span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">3</span></span><br><span class=\"line\">    b := &lt;- chanInt</span><br><span class=\"line\">    chanInt &lt;- <span class=\"number\">4</span></span><br><span class=\"line\">    fmt.Println(b)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"總結\"><a href=\"#總結\" class=\"headerlink\" title=\"總結\"></a>總結</h2><p>今天先介紹到這邊，再來會介紹一些channel的其他功能以及應用。謝謝觀看 :)</p>\n<hr>\n<p><a href=\"#0\">點此回到頁首</a></p>\n",
            "tags": [
                "channel"
            ]
        }
    ]
}